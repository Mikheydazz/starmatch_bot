import telebot
from telebot.types import Message
from telebot import types
from telebot.handler_backends import State, StatesGroup
from telebot.custom_filters import StateFilter
import random
from datetime import datetime
from components import *

TOKEN = "7321100568:AAHawMKy6af-wmSl1G6RmT0dBsUAEaEyfks"
GROUP_ID = -1001928901997  # ID TELEGRAM –ì–†–£–ü–ü–´ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Å –º–∏–Ω—É—Å–æ–º!)
MECHANIC_PRICE = 5  # —Å—Ç–æ–∏–º–æ—Å—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã

bot = telebot.TeleBot(TOKEN)

# –•—Ä–∞–Ω–∏–ª–∏—â–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: { user_id: {"username": "", "balance": int} }
users = {}

# –•—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –º–∞—Ç—Ä–∏—Ü—ã
user_data = {}

# –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–ª—è –º–∞—Ç—Ä–∏—Ü—ã
class MatchStates(StatesGroup):
    waiting_date1 = State()
    waiting_date2 = State()

# –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
@bot.message_handler(commands=["start"])
def start(message: Message):
    user_id = message.from_user.id
    username = message.from_user.username

    if user_id not in users:
        users[user_id] = {"username": username, "balance": 5}  # —Å—Ç–∞—Ä—Ç–æ–≤—ã–π –±–∞–ª–∞–Ω—Å
        bot.send_message(user_id, "‚ú® *–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!*\n\n–í—Å–µ —Ç–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ –±—ã–ª–∏ –ø–æ–ª—É—á–µ–Ω—ã\n–í–∞—à –±–∞–ª–∞–Ω—Å: 5", parse_mode="Markdown")
    else:
        bot.send_message(user_id, f"–ò —Å–Ω–æ–≤–∞ –∑–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ!\n–ë–∞–ª–∞–Ω—Å: {users[user_id]['balance']}")

# –ö–æ–º–∞–Ω–¥–∞ –ø–æ–º–æ—â–∏
@bot.message_handler(commands=["help"])
def help_command(message: Message):
    help_text = """
ü§ñ *–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:*

*–û—Å–Ω–æ–≤–Ω—ã–µ:*
/start - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –Ω–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã
/help - —ç—Ç–∞ —Å–ø—Ä–∞–≤–∫–∞
/balance - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–ª–∞–Ω—Å

*–ú–∞—Ç—Ä–∏—Ü–∞ –°—É–¥—å–±—ã:*
/match - —Ä–∞—Å—á—ë—Ç —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –ø–æ –¥–∞—Ç–∞–º —Ä–æ–∂–¥–µ–Ω–∏—è
/cancel - –æ—Ç–º–µ–Ω–∞ —Ç–µ–∫—É—â–µ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è

*–ò–≥—Ä—ã –∏ —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è:*
/mechanic - —Ç–µ—Å—Ç–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞ (—Å—Ç–æ–∏–º–æ—Å—Ç—å: 5)
/randomuser - —Å–ª—É—á–∞–π–Ω—ã–π —É—á–∞—Å—Ç–Ω–∏–∫ –≥—Ä—É–ø–ø—ã
/yesno - —Å–ª—É—á–∞–π–Ω–æ–µ –î–∞/–ù–µ—Ç

*–§–æ—Ä–º–∞—Ç –¥–∞—Ç—ã –¥–ª—è /match:*
–î–î.–ú–ú.–ì–ì–ì–ì
–ü—Ä–∏–º–µ—Ä: 29.06.2007 –∏–ª–∏ 15.04.1986
"""
    bot.send_message(message.chat.id, help_text, parse_mode="Markdown")

# –ë–∞–ª–∞–Ω—Å
@bot.message_handler(commands=["balance"])
def balance(message: Message):
    user_id = message.from_user.id
    if user_id in users:
        bot.send_message(user_id, f"üí∞ –í–∞—à –±–∞–ª–∞–Ω—Å: *{users[user_id]['balance']}*", parse_mode="Markdown")
    else:
        bot.send_message(user_id, "–í—ã –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã! –ù–∞–ø–∏—à–∏—Ç–µ /start")

# –û—Ç–º–µ–Ω–∞
@bot.message_handler(commands=["cancel"], state="*")
def cancel_match(message: types.Message):
    """–û—Ç–º–µ–Ω–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞"""
    user_id = message.from_user.id
    bot.delete_state(user_id, message.chat.id)
    if user_id in user_data:
        del user_data[user_id]
    
    bot.send_message(
        user_id,
        "‚ùå –ü—Ä–æ—Ü–µ—Å—Å —Ä–∞—Å—á—ë—Ç–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –æ—Ç–º–µ–Ω—ë–Ω.",
        reply_markup=types.ReplyKeyboardRemove()
    )

# –ú–∞—Ç—Ä–∏—Ü–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
@bot.message_handler(commands=["match"])
def start_match(message: types.Message):
    """–ù–∞—á–∞–ª–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ —Ä–∞—Å—á—ë—Ç–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏"""
    user_id = message.from_user.id
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞
    if user_id not in users:
        bot.send_message(user_id, "–í—ã –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã! –ù–∞–ø–∏—à–∏—Ç–µ /start")
        return
    
    if users[user_id]["balance"] < 1:
        bot.send_message(user_id, "‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–∞–ª–∞–Ω—Å–∞ –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞!")
        return
    
    # –°–ø–∏—à–µ–º 1 –µ–¥–∏–Ω–∏—Ü—É –∑–∞ —Ä–∞—Å—á—ë—Ç
    users[user_id]["balance"] -= 1
    
    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    user_data[user_id] = {}
    
    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é
    bot.send_message(
        user_id,
        "üîÆ *–†–ê–°–ß–Å–¢ –°–û–í–ú–ï–°–¢–ò–ú–û–°–¢–ò –ü–û –ú–ê–¢–†–ò–¶–ï –°–£–î–¨–ë–´*\n\n"
        f"–°–ø–∏—Å–∞–Ω–æ: 1 –µ–¥–∏–Ω–∏—Ü–∞\n–ë–∞–ª–∞–Ω—Å: {users[user_id]['balance']}\n\n"
        "–í–≤–µ–¥–∏—Ç–µ *–ø–µ—Ä–≤—É—é* –¥–∞—Ç—É —Ä–æ–∂–¥–µ–Ω–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ:\n"
        "`–î–î.–ú–ú.–ì–ì–ì–ì`\n\n"
        "*–ü—Ä–∏–º–µ—Ä:* `15.04.1986` –∏–ª–∏ `29.06.2007`\n\n"
        "–î–ª—è –æ—Ç–º–µ–Ω—ã –Ω–∞–ø–∏—à–∏—Ç–µ /cancel",
        parse_mode="Markdown"
    )
    
    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–∂–∏–¥–∞–Ω–∏—è –ø–µ—Ä–≤–æ–π –¥–∞—Ç—ã
    bot.set_state(user_id, MatchStates.waiting_date1, message.chat.id)

@bot.message_handler(state=MatchStates.waiting_date1)
def get_date1(message: types.Message):
    """–ü–æ–ª—É—á–∞–µ–º –ø–µ—Ä–≤—É—é –¥–∞—Ç—É"""
    user_id = message.from_user.id
    date_str = message.text.strip()
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∫–æ–º–∞–Ω–¥—É –æ—Ç–º–µ–Ω—ã
    if date_str.lower() == "/cancel":
        cancel_match(message)
        return
    
    # –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞—Ç—ã
    if not validate_date(date_str):
        bot.send_message(
            user_id,
            "‚ùå *–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã!*\n\n"
            "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –¥–∞—Ç—É –≤ —Ñ–æ—Ä–º–∞—Ç–µ:\n"
            "`–î–î.–ú–ú.–ì–ì–ì–ì`\n\n"
            "*–ü—Ä–∏–º–µ—Ä:* `15.04.1986`\n"
            "–ò–ª–∏ –Ω–∞–ø–∏—à–∏—Ç–µ /cancel –¥–ª—è –æ—Ç–º–µ–Ω—ã",
            parse_mode="Markdown"
        )
        return
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–µ—Ä–≤—É—é –¥–∞—Ç—É
    user_data[user_id]['date1'] = date_str
    
    # –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –≤—Ç–æ—Ä—É—é –¥–∞—Ç—É
    bot.send_message(
        user_id,
        f"‚úÖ –ü–µ—Ä–≤–∞—è –¥–∞—Ç–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞: `{date_str}`\n\n"
        "–¢–µ–ø–µ—Ä—å –≤–≤–µ–¥–∏—Ç–µ *–≤—Ç–æ—Ä—É—é* –¥–∞—Ç—É —Ä–æ–∂–¥–µ–Ω–∏—è –≤ —Ç–æ–º –∂–µ —Ñ–æ—Ä–º–∞—Ç–µ:\n\n"
        "–î–ª—è –æ—Ç–º–µ–Ω—ã –Ω–∞–ø–∏—à–∏—Ç–µ /cancel",
        parse_mode="Markdown"
    )
    
    # –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –æ–∂–∏–¥–∞–Ω–∏—é –≤—Ç–æ—Ä–æ–π –¥–∞—Ç—ã
    bot.set_state(user_id, MatchStates.waiting_date2, message.chat.id)

@bot.message_handler(state=MatchStates.waiting_date2)
def get_date2_and_calculate(message: types.Message):
    """–ü–æ–ª—É—á–∞–µ–º –≤—Ç–æ—Ä—É—é –¥–∞—Ç—É –∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å"""
    user_id = message.from_user.id
    date_str = message.text.strip()
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∫–æ–º–∞–Ω–¥—É –æ—Ç–º–µ–Ω—ã
    if date_str.lower() == "/cancel":
        cancel_match(message)
        return
    
    # –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞—Ç—ã
    if not validate_date(date_str):
        bot.send_message(
            user_id,
            "‚ùå *–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã!*\n\n"
            "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –¥–∞—Ç—É –≤ —Ñ–æ—Ä–º–∞—Ç–µ:\n"
            "`–î–î.–ú–ú.–ì–ì–ì–ì`\n\n"
            "–ò–ª–∏ –Ω–∞–ø–∏—à–∏—Ç–µ /cancel –¥–ª—è –æ—Ç–º–µ–Ω—ã",
            parse_mode="Markdown"
        )
        return
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Ç–æ—Ä—É—é –¥–∞—Ç—É
    user_data[user_id]['date2'] = date_str
    date1 = user_data[user_id]['date1']
    
    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º "–ø–µ—á–∞—Ç–∞–µ—Ç..."
    bot.send_chat_action(message.chat.id, 'typing')
    
    try:
        # –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
        result = calculate_compatibility(date1, date_str)
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è callback-–æ–≤
        user_data[user_id]['result'] = result
        
        # –§–æ—Ä–º–∏—Ä—É–µ–º –∫—Ä–∞—Å–∏–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        response = format_match_result(date1, date_str, result)
        
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        bot.send_message(user_id, response, parse_mode="Markdown")
        
        # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
        send_detailed_info(user_id, result)
        
    except Exception as e:
        bot.send_message(
            user_id,
            f"‚ùå *–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞—Å—á—ë—Ç–µ:*\n`{str(e)}`\n\n"
            "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑ –∏–ª–∏ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.",
            parse_mode="Markdown"
        )
        # –í–µ—Ä–Ω—ë–º —Å–ø–∏—Å–∞–Ω–Ω—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞ –ø—Ä–∏ –æ—à–∏–±–∫–µ
        users[user_id]["balance"] += 1
    
    # –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    bot.delete_state(user_id, message.chat.id)

def validate_date(date_str):
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ñ–æ—Ä–º–∞—Ç–∞ –¥–∞—Ç—ã"""
    try:
        day, month, year = map(int, date_str.split('.'))
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ–ø—É—Å—Ç–∏–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
        if not (1 <= day <= 31):
            return False
        if not (1 <= month <= 12):
            return False
        if not (1900 <= year <= 2100):
            return False
            
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –¥–∞—Ç—ã
        datetime(year, month, day)
        
        return True
    except:
        return False

def format_match_result(date1, date2, result):
    """–§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏"""
    matrix_score = result['details']['matrix_score']
    elements_score = result['details']['elements_score']
    key_score = result['details']['key_numbers_score']
    
    # –û—Å–Ω–æ–≤–Ω–æ–π –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å - –º–∞—Ç—Ä–∏—Ü–∞
    main_percentage = matrix_score
    
    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —É—Ä–æ–≤–µ–Ω—å —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –ø–æ –ú–ê–¢–†–ò–¶–ï
    if matrix_score >= 85:
        level = "‚ú® *–ò–î–ï–ê–õ–¨–ù–ê–Ø*"
        emoji = "üíñ"
        advice = "–û—Ç–ª–∏—á–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –≤–æ –≤—Å–µ—Ö —Å—Ñ–µ—Ä–∞—Ö –∂–∏–∑–Ω–∏!"
    elif matrix_score >= 70:
        level = "‚úÖ *–í–´–°–û–ö–ê–Ø*"
        emoji = "üíï"
        advice = "–•–æ—Ä–æ—à–∞—è –±–∞–∑–∞ –¥–ª—è –≥–∞—Ä–º–æ–Ω–∏—á–Ω—ã—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏–π."
    elif matrix_score >= 55:
        level = "‚ö†Ô∏è *–°–†–ï–î–ù–Ø–Ø*"
        emoji = "üíõ"
        advice = "–ï—Å—Ç—å –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª, –Ω–æ –Ω—É–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞ –Ω–∞–¥ –æ—Ç–Ω–æ—à–µ–Ω–∏—è–º–∏."
    elif matrix_score >= 40:
        level = "üî∂ *–ù–ò–ó–ö–ê–Ø*"
        emoji = "üíî"
        advice = "–ü–æ—Ç—Ä–µ–±—É—é—Ç—Å—è –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–∏–ª–∏—è –¥–ª—è –≥–∞—Ä–º–æ–Ω–∏–∏."
    else:
        level = "‚ùå *–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø*"
        emoji = "‚ö°"
        advice = "–°–ª–æ–∂–Ω—ã–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è, –Ω—É–∂–Ω–∞ –±–æ–ª—å—à–∞—è —Ä–∞–±–æ—Ç–∞."
    
    # –ê–Ω–∞–ª–∏–∑ –¥–∏—Å–±–∞–ª–∞–Ω—Å–∞
    imbalance_warning = ""
    scores = [matrix_score, elements_score, key_score]
    max_score = max(scores)
    min_score = min(scores)
    
    if max_score - min_score > 30:
        imbalance_warning = "\n‚ö†Ô∏è *–í–Ω–∏–º–∞–Ω–∏–µ:* –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–π —Ä–∞–∑–±—Ä–æ—Å –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π!"
    elif max_score - min_score > 20:
        imbalance_warning = "\n‚ÑπÔ∏è *–ó–∞–º–µ—Ç–∫–∞:* –ü–æ–∫–∞–∑–∞—Ç–µ–ª–∏ —Ä–∞–∑–ª–∏—á–∞—é—Ç—Å—è –¥–æ–≤–æ–ª—å–Ω–æ —Å–∏–ª—å–Ω–æ."
    
    return (
        f"{emoji} *–†–ï–ó–£–õ–¨–¢–ê–¢ –°–û–í–ú–ï–°–¢–ò–ú–û–°–¢–ò*\n\n"
        f"üìÖ *–î–∞—Ç–∞ 1:* `{date1}`\n"
        f"üìÖ *–î–∞—Ç–∞ 2:* `{date2}`\n"
        f"üéØ *–ì–ª–∞–≤–Ω—ã–π –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å (–ú–ê–¢–†–ò–¶–ê):* `{matrix_score:.1f}%`\n"
        f"üèÜ *–£—Ä–æ–≤–µ–Ω—å —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏:* {level}\n\n"
        
        
        f"{imbalance_warning}\n"
        f"üí° *–°–æ–≤–µ—Ç:* {advice}\n\n"
        f"_–ù–∞–∂–º–∏—Ç–µ '–ß—Ç–æ –æ–∑–Ω–∞—á–∞—é—Ç —ç—Ç–∏ –ø—Ä–æ—Ü–µ–Ω—Ç—ã?' –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–≥–æ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è_"
    )

def analyze_imbalance(matrix_score, elements_score, key_score):
    """–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –¥–∏—Å–±–∞–ª–∞–Ω—Å –º–µ–∂–¥—É –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è–º–∏"""
    imbalance = max(matrix_score, elements_score, key_score) - min(matrix_score, elements_score, key_score)
    
    if imbalance > 40:
        return (
            "üö® *–í–ù–ò–ú–ê–ù–ò–ï: –í–´–°–û–ö–ò–ô –î–ò–°–ë–ê–õ–ê–ù–°!*\n\n"
            "–†–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è–º–∏ —Å–ª–∏—à–∫–æ–º –≤–µ–ª–∏–∫–∞.\n"
            "‚Ä¢ –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –≤ –æ–¥–Ω–∏—Ö —Å—Ñ–µ—Ä–∞—Ö –≤—ã –∏–¥–µ–∞–ª—å–Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã,\n"
            "  –∞ –≤ –¥—Ä—É–≥–∏—Ö - –ø–æ—á—Ç–∏ –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω—ã.\n"
            "‚Ä¢ –¢–∞–∫–∏–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è –º–æ–≥—É—Ç –±—ã—Ç—å —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ exhausting\n"
            "‚Ä¢ –ù—É–∂–Ω–∞ –æ—Å–æ–±–∞—è —Ä–∞–±–æ—Ç–∞ –Ω–∞–¥ –∑–æ–Ω–∞–º–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞"
        )
    elif imbalance > 25:
        return (
            "‚ö†Ô∏è *–ó–ê–ú–ï–¢–ù–´–ô –î–ò–°–ë–ê–õ–ê–ù–°*\n\n"
            "–ü–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —Ä–∞–∑–ª–∏—á–∞—é—Ç—Å—è.\n"
            "‚Ä¢ –í–æ–∑–º–æ–∂–Ω—ã –ø–µ—Ä–∏–æ–¥—ã –≥–∞—Ä–º–æ–Ω–∏–∏ –∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤\n"
            "‚Ä¢ –í–∞–∂–Ω–æ –ø–æ–Ω—è—Ç—å, –∫–∞–∫–∏–µ —Å—Ñ–µ—Ä—ã —Ç—Ä–µ–±—É—é—Ç —Ä–∞–±–æ—Ç—ã\n"
            "‚Ä¢ –§–æ–∫—É—Å–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ —Å–∏–ª—å–Ω—ã—Ö —Å—Ç–æ—Ä–æ–Ω–∞—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏–π"
        )
    elif imbalance > 15:
        return (
            "‚ÑπÔ∏è *–£–ú–ï–†–ï–ù–ù–´–ô –î–ò–°–ë–ê–õ–ê–ù–°*\n\n"
            "–ü–æ–∫–∞–∑–∞—Ç–µ–ª–∏ —Ä–∞–∑–ª–∏—á–∞—é—Ç—Å—è, –Ω–æ —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ.\n"
            "‚Ä¢ –ö–∞–∂–¥–∞—è –ø–∞—Ä–∞ –∏–º–µ–µ—Ç —Å–≤–æ–∏ —Å–∏–ª—å–Ω—ã–µ –∏ —Å–ª–∞–±—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã\n"
            "‚Ä¢ –†–∞–∑–ª–∏—á–∏—è –º–æ–≥—É—Ç –±—ã—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º —Ä–æ—Å—Ç–∞\n"
            "‚Ä¢ –†–∞–±–æ—Ç–∞–π—Ç–µ –Ω–∞–¥ –±–∞–ª–∞–Ω—Å–æ–º —ç–Ω–µ—Ä–≥–∏–π"
        )
    else:
        return (
            "‚úÖ *–°–ë–ê–õ–ê–ù–°–ò–†–û–í–ê–ù–ù–´–ï –ü–û–ö–ê–ó–ê–¢–ï–õ–ò*\n\n"
            "–í—Å–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –±–ª–∏–∑–∫–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ.\n"
            "‚Ä¢ –≠—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç –æ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏\n"
            "‚Ä¢ –û—Ç–Ω–æ—à–µ–Ω–∏—è —Ä–∞–∑–≤–∏–≤–∞—é—Ç—Å—è –≥–∞—Ä–º–æ–Ω–∏—á–Ω–æ\n"
            "‚Ä¢ –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –≤ —Ç–æ–º –∂–µ –¥—É—Ö–µ!"
        )

def send_detailed_info(user_id, result):
    """–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é"""
    # –°–æ–∑–¥–∞—ë–º –∏–Ω–ª–∞–π–Ω-–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –æ–ø—Ü–∏–π
    keyboard = types.InlineKeyboardMarkup(row_width=1)
    
    btn_details = types.InlineKeyboardButton(
        text="üìä –ü–æ–¥—Ä–æ–±–Ω—ã–π –æ—Ç—á—ë—Ç",
        callback_data=f"details_{result['percentage']}"
    )
    btn_matrix = types.InlineKeyboardButton(
        text="üî¢ –ü–æ–∫–∞–∑–∞—Ç—å –º–∞—Ç—Ä–∏—Ü—ã",
        callback_data="show_matrices"
    )
    btn_explanation = types.InlineKeyboardButton(
        text="‚ùì –ß—Ç–æ –æ–∑–Ω–∞—á–∞—é—Ç —ç—Ç–∏ –ø—Ä–æ—Ü–µ–Ω—Ç—ã?",
        callback_data="explain_percentages"
    )
    
    keyboard.add(btn_details, btn_matrix, btn_explanation)
    
    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–µ—Ç–∞–ª–∏
    details_msg = (
        "üìà *–î–ï–¢–ê–õ–ò –†–ê–°–ß–Å–¢–ê*\n\n"
        f"‚Ä¢ *–ü–æ –º–∞—Ç—Ä–∏—Ü–µ (–µ–∂–µ–¥–Ω–µ–≤–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å):* `{result['details']['matrix_score']:.1f}%`\n"
        f"‚Ä¢ *–ü–æ —Å—Ç–∏—Ö–∏—è–º (—ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∞—è –≥–∞—Ä–º–æ–Ω–∏—è):* `{result['details']['elements_score']:.1f}%`\n"
        f"‚Ä¢ *–ü–æ –∫–ª—é—á–µ–≤—ã–º —á–∏—Å–ª–∞–º (–æ–±—â–∏–µ —Ü–µ–ª–∏):* `{result['details']['key_numbers_score']:.1f}%`\n\n"
        "*–í—ã–±–µ—Ä–∏—Ç–µ –æ–ø—Ü–∏—é –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏:*"
    )
    
    bot.send_message(user_id, details_msg, 
                     parse_mode="Markdown", 
                     reply_markup=keyboard)

def format_matrix_for_display(matrix_list):
    """–§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –º–∞—Ç—Ä–∏—Ü—É –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è"""
    return (
        f"‚ïî‚ïê‚ïê‚ïê‚ï¶‚ïê‚ïê‚ïê‚ï¶‚ïê‚ïê‚ïê‚ïó\n"
        f"‚ïë {matrix_list[0]} ‚ïë {matrix_list[1]} ‚ïë {matrix_list[2]} ‚ïë\n"
        f"‚ï†‚ïê‚ïê‚ïê‚ï¨‚ïê‚ïê‚ïê‚ï¨‚ïê‚ïê‚ïê‚ï£\n"
        f"‚ïë {matrix_list[3]} ‚ïë {matrix_list[4]} ‚ïë {matrix_list[5]} ‚ïë\n"
        f"‚ï†‚ïê‚ïê‚ïê‚ï¨‚ïê‚ïê‚ïê‚ï¨‚ïê‚ïê‚ïê‚ï£\n"
        f"‚ïë {matrix_list[6]} ‚ïë {matrix_list[7]} ‚ïë {matrix_list[8]} ‚ïë\n"
        f"‚ïö‚ïê‚ïê‚ïê‚ï©‚ïê‚ïê‚ïê‚ï©‚ïê‚ïê‚ïê‚ïù"
    )

@bot.callback_query_handler(func=lambda call: call.data == "explain_percentages")
def handle_explanation(call):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–∫–∏ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤"""
    user_id = call.from_user.id
    
    if user_id in user_data and 'result' in user_data[user_id]:
        result = user_data[user_id]['result']
        
        # –ü–æ–ª—É—á–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ
        explanation = get_percentages_explanation()
        
        # –î–æ–±–∞–≤–ª—è–µ–º –∞–Ω–∞–ª–∏–∑ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–ª—É—á–∞—è
        matrix_score = result['details']['matrix_score']
        elements_score = result['details']['elements_score']
        key_score = result['details']['key_numbers_score']
        
        specific_analysis = (
            f"\n\nüîç *–ê–ù–ê–õ–ò–ó –í–ê–®–ï–ì–û –°–õ–£–ß–ê–Ø:*\n\n"
            f"‚Ä¢ –ú–∞—Ç—Ä–∏—Ü–∞: `{matrix_score:.1f}%` - {'‚úÖ –•–û–†–û–®–û' if matrix_score >= 60 else '‚ö†Ô∏è –¢–†–ï–ë–£–ï–¢ –í–ù–ò–ú–ê–ù–ò–Ø'}\n"
            f"‚Ä¢ –°—Ç–∏—Ö–∏–∏: `{elements_score:.1f}%` - {'‚úÖ –û–¢–õ–ò–ß–ù–û' if elements_score >= 70 else '‚ö†Ô∏è –°–†–ï–î–ù–ï'}\n"
            f"‚Ä¢ –ö–ª—é—á–µ–≤—ã–µ —á–∏—Å–ª–∞: `{key_score:.1f}%` - {'‚úÖ –í–´–°–û–ö–û' if key_score >= 60 else '‚ö†Ô∏è –ù–ò–ó–ö–û'}\n\n"
        )
        
        imbalance_analysis = analyze_imbalance(matrix_score, elements_score, key_score)
        
        full_response = explanation + specific_analysis + imbalance_analysis
        
        bot.send_message(user_id, full_response, parse_mode="Markdown")
    else:
        bot.send_message(user_id, get_percentages_explanation(), parse_mode="Markdown")
    
    bot.answer_callback_query(call.id)

@bot.callback_query_handler(func=lambda call: True)
def handle_callback(call):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏–π –Ω–∞ –∏–Ω–ª–∞–π–Ω-–∫–Ω–æ–ø–∫–∏"""
    user_id = call.from_user.id
    
    if call.data.startswith("details_"):
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—é —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
        percentage = float(call.data.split("_")[1])
        
        interpretation = get_interpretation(percentage)
        
        bot.send_message(
            user_id,
            interpretation,
            parse_mode="Markdown"
        )
        
        bot.answer_callback_query(call.id)
        
    elif call.data == "show_matrices":
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–∞—Ç—Ä–∏—Ü—ã
        if user_id in user_data and 'result' in user_data[user_id]:
            result = user_data[user_id]['result']
            
            matrix1_text = format_matrix_for_display(result['person1']['matrix'])
            matrix2_text = format_matrix_for_display(result['person2']['matrix'])
            
            response = (
                "üî¢ *–ú–ê–¢–†–ò–¶–´ –°–£–î–¨–ë–´*\n\n"
                "*–ü–µ—Ä–≤–∞—è –º–∞—Ç—Ä–∏—Ü–∞:*\n"
                f"```\n{matrix1_text}\n```\n\n"
                "*–í—Ç–æ—Ä–∞—è –º–∞—Ç—Ä–∏—Ü–∞:*\n"
                f"```\n{matrix2_text}\n```\n\n"
                "_–î–ª—è –Ω–æ–≤–æ–≥–æ —Ä–∞—Å—á—ë—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ /match_"
            )
            
            bot.send_message(user_id, response, parse_mode="Markdown")
        else:
            bot.send_message(user_id, "‚ùå –î–∞–Ω–Ω—ã–µ –º–∞—Ç—Ä–∏—Ü –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –ù–∞—á–Ω–∏—Ç–µ –Ω–æ–≤—ã–π —Ä–∞—Å—á—ë—Ç —Å /match")
        
        bot.answer_callback_query(call.id)
    
    elif call.data == "explain_percentages":
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤
        explanation = get_percentages_explanation()
        
        bot.send_message(
            user_id,
            explanation,
            parse_mode="Markdown"
        )
        
        bot.answer_callback_query(call.id)

def get_percentages_explanation():
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ —á—Ç–æ –æ–∑–Ω–∞—á–∞—é—Ç –ø—Ä–æ—Ü–µ–Ω—Ç—ã"""
    return (
        "üìä *–ß–¢–û –û–ó–ù–ê–ß–ê–Æ–¢ –≠–¢–ò –ü–†–û–¶–ï–ù–¢–´?*\n\n"
        
        "üéØ *–ì–õ–ê–í–ù–´–ô –ü–û–ö–ê–ó–ê–¢–ï–õ–¨ - –ú–ê–¢–†–ò–¶–ê*\n"
        "–≠—Ç–æ *—Å–∞–º—ã–π –≤–∞–∂–Ω—ã–π* –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å, –ø–æ—Ç–æ–º—É —á—Ç–æ –æ–Ω —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç:\n"
        "‚Ä¢ 9 —Å—Ñ–µ—Ä –∂–∏–∑–Ω–∏ (—Ö–∞—Ä–∞–∫—Ç–µ—Ä, –æ—Ç–Ω–æ—à–µ–Ω–∏—è, –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç, –∑–¥–æ—Ä–æ–≤—å–µ –∏ —Ç.–¥.)\n"
        "‚Ä¢ –ï–∂–µ–¥–Ω–µ–≤–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –∏ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å\n"
        "‚Ä¢ –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫—É—é —Å—Ç–æ—Ä–æ–Ω—É –æ—Ç–Ω–æ—à–µ–Ω–∏–π\n\n"
        
        "*–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è:*\n"
        "‚Ä¢ `85-100%` - –ò–¥–µ–∞–ª—å–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –≤–æ –≤—Å–µ—Ö —Å—Ñ–µ—Ä–∞—Ö –∂–∏–∑–Ω–∏\n"
        "‚Ä¢ `70-84%` - –í—ã—Å–æ–∫–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å, –µ—Å—Ç—å –æ–±—â–∏–µ —Ü–µ–ª–∏\n"
        "‚Ä¢ `55-69%` - –°—Ä–µ–¥–Ω—è—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å, —Ä–∞–∑–ª–∏—á–∏—è –∑–∞–º–µ—Ç–Ω—ã\n"
        "‚Ä¢ `40-54%` - –ù–∏–∑–∫–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å, –º–Ω–æ–≥–æ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–π\n"
        "‚Ä¢ `0-39%` - –ö–∞—Ä–¥–∏–Ω–∞–ª—å–Ω–æ —Ä–∞–∑–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã –∫ –∂–∏–∑–Ω–∏\n\n"
        
        "üåø *–°–¢–ò–•–ò–ò - –≠–ù–ï–†–ì–ï–¢–ò–ß–ï–°–ö–ê–Ø –°–û–í–ú–ï–°–¢–ò–ú–û–°–¢–¨*\n"
        "–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≥–∞—Ä–º–æ–Ω–∏—é –≤–∞—à–∏—Ö —ç–Ω–µ—Ä–≥–∏–π:\n"
        "‚Ä¢ –û–≥–æ–Ω—å - –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å, —Å—Ç—Ä–∞—Å—Ç—å, –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤–∞\n"
        "‚Ä¢ –ó–µ–º–ª—è - —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å, –ø—Ä–∞–∫—Ç–∏—á–Ω–æ—Å—Ç—å, –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å\n"
        "‚Ä¢ –í–æ–∑–¥—É—Ö - –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç, –æ–±—â–µ–Ω–∏–µ, –∏–¥–µ–∏\n"
        "‚Ä¢ –í–æ–¥–∞ - —ç–º–æ—Ü–∏–∏, —á—É–≤—Å—Ç–≤–∞, –∏–Ω—Ç—É–∏—Ü–∏—è\n\n"
        
        "*–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è:*\n"
        "‚Ä¢ `85-100%` - –ò–¥–µ–∞–ª—å–Ω—ã–π —ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–π –±–∞–ª–∞–Ω—Å\n"
        "‚Ä¢ `70-84%` - –ì–∞—Ä–º–æ–Ω–∏—á–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —ç–Ω–µ—Ä–≥–∏–π\n"
        "‚Ä¢ `55-69%` - –≠–Ω–µ—Ä–≥–∏–∏ –∏–Ω–æ–≥–¥–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—Ç\n"
        "‚Ä¢ `40-54%` - –ß–∞—Å—Ç—ã–µ —ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—è\n"
        "‚Ä¢ `0-39%` - –ü—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–≤—ã–µ —ç–Ω–µ—Ä–≥–∏–∏\n\n"
        
        "üîë *–ö–õ–Æ–ß–ï–í–´–ï –ß–ò–°–õ–ê - –°–£–î–¨–ë–û–ù–û–°–ù–ê–Ø –°–û–í–ú–ï–°–¢–ò–ú–û–°–¢–¨*\n"
        "–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –≤–∞—à–∏—Ö –∫–∞—Ä–º–∏—á–µ—Å–∫–∏—Ö –∑–∞–¥–∞—á:\n"
        "‚Ä¢ –ß–∏—Å–ª–æ –°—É–¥—å–±—ã - –≥–ª–∞–≤–Ω–∞—è –∂–∏–∑–Ω–µ–Ω–Ω–∞—è –º–∏—Å—Å–∏—è\n"
        "‚Ä¢ –ß–∏—Å–ª–æ –õ–∏—á–Ω–æ—Å—Ç–∏ - –∫–∞–∫ –≤—ã –ø—Ä–æ—è–≤–ª—è–µ—Ç–µ—Å—å –≤ –º–∏—Ä–µ\n"
        "‚Ä¢ –ö–∞—Ä–º–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏ - —É—Ä–æ–∫–∏ –¥–ª—è —Ä–∞–∑–≤–∏—Ç–∏—è\n\n"
        
        "*–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è:*\n"
        "‚Ä¢ `85-100%` - –û–¥–∏–Ω–∞–∫–æ–≤—ã–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–µ —Ü–µ–ª–∏ –∏ –ø—É—Ç—å\n"
        "‚Ä¢ `70-84%` - –í–∑–∞–∏–º–æ–¥–æ–ø–æ–ª–Ω—è—é—â–∏–µ –∑–∞–¥–∞—á–∏\n"
        "‚Ä¢ `55-69%` - –†–∞–∑–Ω—ã–µ, –Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–µ –∑–∞–¥–∞—á–∏\n"
        "‚Ä¢ `40-54%` - –ü—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–≤—ã–µ –∫–∞—Ä–º–∏—á–µ—Å–∫–∏–µ —É—Ä–æ–∫–∏\n"
        "‚Ä¢ `0-39%` - –ü—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω—ã–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–µ –ø—É—Ç–∏\n\n"
        
        "‚ö†Ô∏è *–ß–¢–û –î–ï–õ–ê–¢–¨, –ï–°–õ–ò –û–î–ò–ù –ü–û–ö–ê–ó–ê–¢–ï–õ–¨ –ó–ù–ê–ß–ò–¢–ï–õ–¨–ù–û –ù–ò–ñ–ï?*\n\n"
        
        "*–°–ª—É—á–∞–π 1: –ù–∏–∑–∫–∏–µ –∫–ª—é—á–µ–≤—ã–µ —á–∏—Å–ª–∞*\n"
        "‚úÖ *–ù–µ –∫—Ä–∏—Ç–∏—á–Ω–æ!*\n"
        "‚Ä¢ –ö–ª—é—á–µ–≤—ã–µ —á–∏—Å–ª–∞ –≤–ª–∏—è—é—Ç –Ω–∞ –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ —Ü–µ–ª–∏\n"
        "‚Ä¢ –í—ã –º–æ–∂–µ—Ç–µ –∏–º–µ—Ç—å —Ä–∞–∑–Ω—ã–µ –º–∏—Å—Å–∏–∏, –Ω–æ –≥–∞—Ä–º–æ–Ω–∏—á–Ω–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å\n"
        "‚Ä¢ –ü—Ä–∏–º–µ—Ä: –û–¥–∏–Ω —Ö–æ—á–µ—Ç —Å–µ–º—å—é, –¥—Ä—É–≥–æ–π - –∫–∞—Ä—å–µ—Ä—É, –Ω–æ –Ω–∞—Ö–æ–¥—è—Ç –±–∞–ª–∞–Ω—Å\n\n"
        
        "*–°–ª—É—á–∞–π 2: –ù–∏–∑–∫–∏–µ —Å—Ç–∏—Ö–∏–∏*\n"
        "‚ö†Ô∏è *–¢—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞–Ω–∏—è!*\n"
        "‚Ä¢ –≠–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –º–æ–≥—É—Ç –≤—ã–∑—ã–≤–∞—Ç—å —É—Å—Ç–∞–ª–æ—Å—Ç—å\n"
        "‚Ä¢ –ù—É–∂–Ω–æ —É—á–∏—Ç—å—Å—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞—Ç—å —ç–Ω–µ—Ä–≥–∏–∏\n"
        "‚Ä¢ –ü—Ä–∏–º–µ—Ä: –ê–∫—Ç–∏–≤–Ω—ã–π –û–≥–æ–Ω—å + –°–ø–æ–∫–æ–π–Ω–∞—è –í–æ–¥–∞ = —É—á–∏—Ç—å—Å—è —Ç–µ—Ä–ø–µ–Ω–∏—é\n\n"
        
        "*–°–ª—É—á–∞–π 3: –ù–∏–∑–∫–∞—è –º–∞—Ç—Ä–∏—Ü–∞*\n"
        "‚ùå *–ö—Ä–∏—Ç–∏—á–Ω–æ!*\n"
        "‚Ä¢ –ú–∞—Ç—Ä–∏—Ü–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –µ–∂–µ–¥–Ω–µ–≤–Ω—É—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å\n"
        "‚Ä¢ –ù–∏–∑–∫–∏–π –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å –æ–∑–Ω–∞—á–∞–µ—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–µ —Ä–∞–∑–Ω–æ–≥–ª–∞—Å–∏—è\n"
        "‚Ä¢ –¢—Ä–µ–±—É—é—Ç—Å—è –æ–≥—Ä–æ–º–Ω—ã–µ —É—Å–∏–ª–∏—è –¥–ª—è –≥–∞—Ä–º–æ–Ω–∏–∏\n\n"
        
        "üí° *–í–ê–ñ–ù–´–ï –í–´–í–û–î–´:*\n"
        "1. *–ú–∞—Ç—Ä–∏—Ü–∞* - –≥–ª–∞–≤–Ω—ã–π –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏\n"
        "2. *–°—Ç–∏—Ö–∏–∏* - –≤–∞–∂–Ω—ã –¥–ª—è —ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–æ–≥–æ –∫–æ–º—Ñ–æ—Ä—Ç–∞\n"
        "3. *–ö–ª—é—á–µ–≤—ã–µ —á–∏—Å–ª–∞* - –≤–ª–∏—è—é—Ç –Ω–∞ –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ —Ü–µ–ª–∏\n"
        "4. *–ò–¥–µ–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å* - –∫–æ–≥–¥–∞ –≤—Å–µ —Ç—Ä–∏ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è –≤—ã—à–µ 70%\n"
        "5. *–ü—Ä–∏–µ–º–ª–µ–º—ã–π –≤–∞—Ä–∏–∞–Ω—Ç* - –º–∞—Ç—Ä–∏—Ü–∞ > 60%, –æ—Å—Ç–∞–ª—å–Ω—ã–µ –Ω–µ –Ω–∏–∂–µ 45%\n\n"
        
    )

def get_interpretation(percentage):
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—é —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞"""
    if percentage >= 85:
        return (
            "‚ú® *–ò–î–ï–ê–õ–¨–ù–ê–Ø –°–û–í–ú–ï–°–¢–ò–ú–û–°–¢–¨*\n\n"
            f"*–£—Ä–æ–≤–µ–Ω—å:* `{percentage:.1f}%`\n\n"
            "*–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:*\n"
            "‚Ä¢ –ü–æ–Ω–∏–º–∞–µ—Ç–µ –¥—Ä—É–≥ –¥—Ä—É–≥–∞ —Å –ø–æ–ª—É—Å–ª–æ–≤–∞\n"
            "‚Ä¢ –û–±—â–∏–µ —Ü–µ–ª–∏ –∏ –∂–∏–∑–Ω–µ–Ω–Ω—ã–µ —Ü–µ–Ω–Ω–æ—Å—Ç–∏\n"
            "‚Ä¢ –í–∑–∞–∏–º–Ω–æ–µ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞\n"
            "‚Ä¢ –°–∏–ª—å–Ω–∞—è –∫–∞—Ä–º–∏—á–µ—Å–∫–∞—è —Å–≤—è–∑—å\n\n"
            "*–ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç —ç—Ç–æ—Ç –ø—Ä–æ—Ü–µ–Ω—Ç:*\n"
            "–í–∞—à–∏ —ç–Ω–µ—Ä–≥–∏–∏, –º–∞—Ç—Ä–∏—Ü—ã –∏ –∂–∏–∑–Ω–µ–Ω–Ω—ã–µ –ø—É—Ç–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –ø–æ—á—Ç–∏ –∏–¥–µ–∞–ª—å–Ω–æ–π –≥–∞—Ä–º–æ–Ω–∏–∏. "
            "–≠—Ç–æ —Ä–µ–¥–∫–∏–π –∏ —Ü–µ–Ω–Ω—ã–π —Å–æ—é–∑ —Å –æ–≥—Ä–æ–º–Ω—ã–º –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª–æ–º —Ä–∞–∑–≤–∏—Ç–∏—è.\n\n"
            "*–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:*\n"
            "‚Ä¢ –†–∞–∑–≤–∏–≤–∞–π—Ç–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è —Å–º–µ–ª–æ\n"
            "‚Ä¢ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–µ –æ–±—â–µ–Ω–∏–µ\n"
            "‚Ä¢ –°—Ç—Ä–æ–π—Ç–µ —Å–æ–≤–º–µ—Å—Ç–Ω—ã–µ –ø–ª–∞–Ω—ã"
        )
    elif percentage >= 70:
        return (
            "‚úÖ *–í–´–°–û–ö–ê–Ø –°–û–í–ú–ï–°–¢–ò–ú–û–°–¢–¨*\n\n"
            f"*–£—Ä–æ–≤–µ–Ω—å:* `{percentage:.1f}%`\n\n"
            "*–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:*\n"
            "‚Ä¢ –ú–Ω–æ–≥–æ –æ–±—â–µ–≥–æ –∏ –≤–∑–∞–∏–º–æ–ø–æ–Ω–∏–º–∞–Ω–∏—è\n"
            "‚Ä¢ –ú–æ–∂–µ—Ç–µ –±—ã—Ç—å –æ—Ç–ª–∏—á–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π\n"
            "‚Ä¢ –ü—Ä–∏ –∂–µ–ª–∞–Ω–∏–∏ - –ø—Ä–µ–∫—Ä–∞—Å–Ω—ã–π —Å–æ—é–∑\n"
            "‚Ä¢ –ù–µ–±–æ–ª—å—à–∏–µ —Ä–∞–∑–ª–∏—á–∏—è —Ç–æ–ª—å–∫–æ —É–∫—Ä–µ–ø–ª—è—é—Ç —Å–≤—è–∑—å\n\n"
            "*–ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç —ç—Ç–æ—Ç –ø—Ä–æ—Ü–µ–Ω—Ç:*\n"
            "–•–æ—Ä–æ—à–∞—è –±–∞–∑–∞ –¥–ª—è –æ—Ç–Ω–æ—à–µ–Ω–∏–π. –ï—Å—Ç—å –≤—Å–µ –ø—Ä–µ–¥–ø–æ—Å—ã–ª–∫–∏ –¥–ª—è –≥–∞—Ä–º–æ–Ω–∏—á–Ω–æ–≥–æ —Å–æ—é–∑–∞, "
            "–ø—Ä–∏ —É—Å–ª–æ–≤–∏–∏ –≤–∑–∞–∏–º–Ω—ã—Ö —É—Å–∏–ª–∏–π –∏ —É–≤–∞–∂–µ–Ω–∏—è –∫ –Ω–µ–±–æ–ª—å—à–∏–º —Ä–∞–∑–ª–∏—á–∏—è–º.\n\n"
            "*–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:*\n"
            "‚Ä¢ –£–¥–µ–ª—è–π—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –æ–±—â–µ–Ω–∏—é\n"
            "‚Ä¢ –£—á–∏—Ç–µ—Å—å –∏–¥—Ç–∏ –Ω–∞ –∫–æ–º–ø—Ä–æ–º–∏—Å—Å—ã\n"
            "‚Ä¢ –†–∞–∑–≤–∏–≤–∞–π—Ç–µ –æ–±—â–∏–µ –∏–Ω—Ç–µ—Ä–µ—Å—ã"
        )
    elif percentage >= 55:
        return (
            "‚ö†Ô∏è *–°–†–ï–î–ù–Ø–Ø –°–û–í–ú–ï–°–¢–ò–ú–û–°–¢–¨*\n\n"
            f"*–£—Ä–æ–≤–µ–Ω—å:* `{percentage:.1f}%`\n\n"
            "*–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:*\n"
            "‚Ä¢ –ï—Å—Ç—å –∫–∞–∫ –æ–±—â–µ–µ, —Ç–∞–∫ –∏ —Ä–∞–∑–ª–∏—á–∏—è\n"
            "‚Ä¢ –í–∑–∞–∏–º–æ–ø–æ–Ω–∏–º–∞–Ω–∏–µ —Ç—Ä–µ–±—É–µ—Ç —É—Å–∏–ª–∏–π\n"
            "‚Ä¢ –ú–æ–∂–µ—Ç–µ –¥–æ–ø–æ–ª–Ω—è—Ç—å –¥—Ä—É–≥ –¥—Ä—É–≥–∞\n"
            "‚Ä¢ –£–º–µ—Ä–µ–Ω–Ω—ã–π –∫–∞—Ä–º–∏—á–µ—Å–∫–∏–π –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª\n\n"
            "*–ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç —ç—Ç–æ—Ç –ø—Ä–æ—Ü–µ–Ω—Ç:*\n"
            "–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª –¥–ª—è –æ—Ç–Ω–æ—à–µ–Ω–∏–π –µ—Å—Ç—å, –Ω–æ –æ–Ω –ø–æ—Ç—Ä–µ–±—É–µ—Ç —Ä–∞–±–æ—Ç—ã –Ω–∞–¥ —Å–æ–±–æ–π –∏ –ø–∞—Ä—Ç–Ω—ë—Ä–æ–º. "
            "–†–∞–∑–ª–∏—á–∏—è –º–æ–∂–Ω–æ –ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å –≤ –¥–æ—Å—Ç–æ–∏–Ω—Å—Ç–≤–∞, –µ—Å–ª–∏ –ø–æ–¥—Ö–æ–¥–∏—Ç—å –∫ –Ω–∏–º —Å —É–º–æ–º.\n\n"
            "*–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:*\n"
            "‚Ä¢ –£–≤–∞–∂–∞–π—Ç–µ —Ä–∞–∑–ª–∏—á–∏—è –¥—Ä—É–≥ –¥—Ä—É–≥–∞\n"
            "‚Ä¢ –£—á–∏—Ç–µ—Å—å —Å–ª—É—à–∞—Ç—å –∏ —Å–ª—ã—à–∞—Ç—å\n"
            "‚Ä¢ –†–∞–±–æ—Ç–∞–π—Ç–µ –Ω–∞–¥ –∫–æ–º–ø—Ä–æ–º–∏—Å—Å–∞–º–∏"
        )
    elif percentage >= 40:
        return (
            "üî∂ *–ù–ò–ó–ö–ê–Ø –°–û–í–ú–ï–°–¢–ò–ú–û–°–¢–¨*\n\n"
            f"*–£—Ä–æ–≤–µ–Ω—å:* `{percentage:.1f}%`\n\n"
            "*–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:*\n"
            "‚Ä¢ –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–∞–∑–ª–∏—á–∏—è –≤ –ø–æ–¥—Ö–æ–¥–∞—Ö\n"
            "‚Ä¢ –ü–æ–Ω–∏–º–∞–Ω–∏–µ —Ç—Ä–µ–±—É–µ—Ç —Ç–µ—Ä–ø–µ–Ω–∏—è\n"
            "‚Ä¢ –í–æ–∑–º–æ–∂–Ω—ã —á–∞—Å—Ç—ã–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã\n"
            "‚Ä¢ –°–ª–∞–±—ã–π –∫–∞—Ä–º–∏—á–µ—Å–∫–∏–π –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª\n\n"
            "*–ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç —ç—Ç–æ—Ç –ø—Ä–æ—Ü–µ–Ω—Ç:*\n"
            "–û—Ç–Ω–æ—à–µ–Ω–∏—è –ø–æ—Ç—Ä–µ–±—É—é—Ç –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã—Ö —É—Å–∏–ª–∏–π —Å –æ–±–µ–∏—Ö —Å—Ç–æ—Ä–æ–Ω. "
            "–í–∞–∂–Ω–æ –±—ã—Ç—å –≥–æ—Ç–æ–≤—ã–º –∫ —Ä–∞–±–æ—Ç–µ –Ω–∞–¥ —Å–æ–±–æ–π –∏ –ø—Ä–∏–Ω—è—Ç–∏—é –ø–∞—Ä—Ç–Ω—ë—Ä–∞ —Å–æ –≤—Å–µ–º–∏ —Ä–∞–∑–ª–∏—á–∏—è–º–∏.\n\n"
            "*–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:*\n"
            "‚Ä¢ –ë—É–¥—å—Ç–µ —Ç–µ—Ä–ø–µ–ª–∏–≤—ã –∏ —Ç–∞–∫—Ç–∏—á–Ω—ã\n"
            "‚Ä¢ –ò–∑–±–µ–≥–∞–π—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—á–Ω–æ—Å—Ç–∏\n"
            "‚Ä¢ –£—á–∏—Ç–µ—Å—å –¥–æ–≥–æ–≤–∞—Ä–∏–≤–∞—Ç—å—Å—è"
        )
    else:
        return (
            "‚ùå *–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –°–û–í–ú–ï–°–¢–ò–ú–û–°–¢–¨*\n\n"
            f"*–£—Ä–æ–≤–µ–Ω—å:* `{percentage:.1f}%`\n\n"
            "*–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:*\n"
            "‚Ä¢ –ö–∞—Ä–¥–∏–Ω–∞–ª—å–Ω–æ —Ä–∞–∑–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã –∫ –∂–∏–∑–Ω–∏\n"
            "‚Ä¢ –ß–∞—Å—Ç—ã–µ –Ω–µ–¥–æ–ø–æ–Ω–∏–º–∞–Ω–∏—è –∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã\n"
            "‚Ä¢ –¢—Ä–µ–±—É—é—Ç—Å—è –æ–≥—Ä–æ–º–Ω—ã–µ —É—Å–∏–ª–∏—è —Å –æ–±–µ–∏—Ö —Å—Ç–æ—Ä–æ–Ω\n"
            "‚Ä¢ –ö–∞—Ä–º–∏—á–µ—Å–∫–∏–µ —É—Ä–æ–∫–∏ –¥–ª—è –æ–±–æ–∏—Ö\n\n"
            "*–ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç —ç—Ç–æ—Ç –ø—Ä–æ—Ü–µ–Ω—Ç:*\n"
            "–≠—Ç–æ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã—Ö —Ä–∞–∑–ª–∏—á–∏–π –≤ –∂–∏–∑–Ω–µ–Ω–Ω—ã—Ö –ø–æ–¥—Ö–æ–¥–∞—Ö, —Ü–µ–Ω–Ω–æ—Å—Ç—è—Ö –∏ —ç–Ω–µ—Ä–≥–∏—è—Ö. "
            "–¢–∞–∫–∏–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è –º–æ–≥—É—Ç –±—ã—Ç—å —Ü–µ–Ω–Ω—ã–º —É—Ä–æ–∫–æ–º, –Ω–æ –±—É–¥—É—Ç –æ—á–µ–Ω—å —Å–ª–æ–∂–Ω—ã–º–∏.\n\n"
            "*–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:*\n"
            "‚Ä¢ –°–æ–±–ª—é–¥–∞–π—Ç–µ –ª–∏—á–Ω—ã–µ –≥—Ä–∞–Ω–∏—Ü—ã\n"
            "‚Ä¢ –ò–∑–±–µ–≥–∞–π—Ç–µ –¥–∞–≤–ª–µ–Ω–∏—è –Ω–∞ –ø–∞—Ä—Ç–Ω—ë—Ä–∞\n"
            "‚Ä¢ –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –¥—Ä—É–≥–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –ø–∞—Ä—Ç–Ω—ë—Ä—Å—Ç–≤–∞"
        )

# –ú–µ—Ö–∞–Ω–∏–∫–∞: –∫–æ–º–∞–Ω–¥–∞ —Ç—Ä–∞—Ç–∏—Ç –±–∞–ª–∞–Ω—Å
@bot.message_handler(commands=["mechanic"])
def mechanic(message: Message):
    user_id = message.from_user.id
    
    if user_id not in users:
        bot.send_message(user_id, "–í—ã –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã! –ù–∞–ø–∏—à–∏—Ç–µ /start")
        return

    if users[user_id]["balance"] < MECHANIC_PRICE:
        bot.send_message(user_id, f"‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–∞–ª–∞–Ω—Å–∞! –ù—É–∂–Ω–æ: {MECHANIC_PRICE}, —É –≤–∞—Å: {users[user_id]['balance']}")
        return

    users[user_id]["balance"] -= MECHANIC_PRICE
    bot.send_message(user_id, f"‚úÖ –ö–æ–º–∞–Ω–¥–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞! –ë–∞–ª–∞–Ω—Å: {users[user_id]['balance']}")

# –°–ª—É—á–∞–π–Ω—ã–π —É—á–∞—Å—Ç–Ω–∏–∫
@bot.message_handler(commands=["randomuser"])
def random_user(message: Message):
    try:
        members = bot.get_chat_administrators(GROUP_ID)
        usernames = [m.user.username for m in members if m.user.username]

        if usernames:
            bot.send_message(message.chat.id, f"üé≤ –°–ª—É—á–∞–π–Ω—ã–π —É—á–∞—Å—Ç–Ω–∏–∫: @{random.choice(usernames)}")
        else:
            bot.send_message(message.chat.id, "–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤")
    except Exception as e:
        bot.send_message(message.chat.id, f"–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤: {str(e)}")

# –°–ª—É—á–∞–π–Ω–æ–µ "–¥–∞" / "–Ω–µ—Ç"
@bot.message_handler(commands=["yesno"])
def yesno(message: Message):
    result = random.choice(["‚úÖ –î–∞", "‚ùå –ù–µ—Ç"])
    bot.send_message(message.chat.id, f"üéØ {result}")

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –∫–æ–º–∞–Ω–¥
@bot.message_handler(func=lambda message: True)
def handle_unknown(message: Message):
    if message.text.startswith('/'):
        bot.send_message(message.chat.id, "‚ùì –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /help –¥–ª—è —Å–ø–∏—Å–∫–∞ –∫–æ–º–∞–Ω–¥")

# –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
if __name__ == "__main__":
    # –î–æ–±–∞–≤–ª—è–µ–º –∫–∞—Å—Ç–æ–º–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã
    bot.add_custom_filter(StateFilter(bot))
    
    print("ü§ñ –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!")
    print("–ö–æ–º–∞–Ω–¥—ã:")
    print("/start - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è")
    print("/match - —Ä–∞—Å—á—ë—Ç —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏")
    print("/help - —Å–ø—Ä–∞–≤–∫–∞")
    
    bot.polling(none_stop=True)